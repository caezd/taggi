function e(e,n,r,o="beforeend"){const{start:s,end:c}=function(e,n,r="beforeend"){const o=`taggi:start:${n}`,s=`taggi:end:${n}`;let c=t(e,o),i=t(e,s);c&&i||(e.insertAdjacentHTML(r,`\x3c!--${o}--\x3e\x3c!--${s}--\x3e`),c=t(e,o),i=t(e,s));return{start:c,end:i}}(e,n,o);let i=s.nextSibling;for(;i&&i!==c;){const e=i.nextSibling;i.parentNode.removeChild(i),i=e}const u=Array.from(new Set(r));if(!u.length)return;const a=document.createElement("template");a.innerHTML=u.join(""),s.parentNode.insertBefore(a.content,c)}function t(e,t){const n=document.createTreeWalker(e,NodeFilter.SHOW_COMMENT,null);let r;for(;r=n.nextNode();)if(r.nodeValue===t)return r;return null}class n{constructor(e,t={}){this.config=e||{},this.options=Object.assign({defaultSelector:".taggit",fallbackOutput:(e,t)=>`<span class="taggit" data-tag="${t}">${e}</span>`},t),this.init()}init(t){const n=function(e){if(!e)return document;if("string"==typeof e){const t=document.createElement("template");return t.innerHTML=e,t.content}return e}(t);Object.entries(this.config).forEach(([t,r])=>{let o=r.selector||this.options.defaultSelector;Array.isArray(o)||(o=[o]);const s=Array.from(new Set(o.flatMap(e=>Array.from(n.querySelectorAll(e)))));if(!s.length)return;const c=new Map;if(s.forEach(e=>{const n=e.innerHTML,o=r.regex?this.parseRegex(n,r):this.parseShortcodeForTag(n,t,r);if(o.content!==n&&(e.innerHTML=o.content),r.inject&&o.found.length){const t=function(e,t){if("function"==typeof e)return e(t);if("string"==typeof e){const n=e.trim();if(!n)return null;if(n.startsWith("!")){const e=n.slice(1).trim();return e&&t.closest?t.closest(e):null}return t.closest?.(n)||document.querySelector(n)}return null}(r.inject,e);if(!t)return;c.has(t)||c.set(t,[]),c.get(t).push(...o.found)}}),r.inject&&c.size){const n=function(e){switch(e){case"afterbegin":case"beforeend":return e;case"after":return"afterbegin";default:return"beforeend"}}(r.position);for(const[r,o]of c)e(r,t,o,n)}})}parseShortcodeForTag(e,t,n){const r=[];return{content:e.replace(/\[([^\s\]]+)\s+([^\]]+)\]/g,(e,o,s)=>{if(o!==t)return e;const c=(n&&"function"==typeof n.output&&n.output||this.options.fallbackOutput)(s,o);return r.push(c),n&&n.inject?"":c}),found:r}}parseRegex(e,t){const n=[];let r=e;const o=t.regex.flags.includes("g")?t.regex.flags:t.regex.flags+"g",s=new RegExp(t.regex.source,o),c=new RegExp(t.regex.source,o);let i;for(;null!==(i=s.exec(e));){const e=t.output(...i.slice(1));n.push(e)}return r=r.replace(c,""),{content:r,found:n}}}export{n as default};
//# sourceMappingURL=taggi.esm.js.map
